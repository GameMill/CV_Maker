<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js" integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/" crossorigin="anonymous"></script>
    <script src="./Ext/Boxed_Texted.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script>
        var Data = null
        Debug = false;
        function LoadTemplate(data)
        {
            $("#TemplateName").html("Template: "+data["Details"]["Name"])
            Data = data;
        }
        function GetDataObject()
        {
            var Data = {
                "Template":$('#Templates').find(":selected").attr("value"),
                "Name": $("#Name").val(),
                "JobTitle": $("#JobTitle").val(),
                "Contacts":{},
                "Summary":$("#Summary").val()
            }
            
            $("#ContactsList tbody > tr").each(function () 
            { 
                var children = $(this).children();
                var Name = $(children[0]).text();
                var Value = $(children[1]).text();
                Data["Contacts"][Name] = Value
            });
            return Data;
            //console.log(Data) 
           // download(Data["Name"]+".json",JSON.stringify(Data))
        }

        function MakePage()
        {//W:210.0015555555555 //H:297.0000833333333
            if(Data == null)
            {
                alert("You need to load a template file first.")
                return;
            }
            var Info = GetDataObject()

            // Default export is a4 paper, portrait, using milimeters for units
            var doc = new jsPDF()
            console.log(doc.getFontList())

            console.log(doc.internal.pageSize.getWidth(),doc.internal.pageSize.getHeight())

            if(Data["AddFeatures"] != undefined)
            {
                Data["AddFeatures"].forEach(element => {
                    if(element["Type"] == "Box")
                    {
                        var orgcolor = doc.getDrawColor()
                        var orgcolor2 = doc.getFillColor()
                        
                        doc.setDrawColor(element["Color"][0],element["Color"][1],element["Color"][2]);
                        doc.setFillColor(element["Color"][0],element["Color"][1],element["Color"][2]);
                        doc.rect(element["X"], element["Y"], element["Width"], element["Height"], 'F');
                        doc.setDrawColor(orgcolor);
                        doc.setFillColor(orgcolor2);

                        orgcolor = undefined
                        orgcolor2 = undefined
                    }

                    
                });
            }

            current_y = 0
            if(Data["Style"] != undefined)
            {
                if(Data["Style"]["Name"] != undefined){
                    Name = Info["Name"]
                    doc.setFont(Data["Style"]["Name"]["Font"][0],Data["Style"]["Name"]["Font"][1])
                    doc.setFontSize(Data["Style"]["Name"]["FontSize"]);
                    doc.setTextColor(Data["Style"]["Name"]["Color"][0],Data["Style"]["Name"]["Color"][1],Data["Style"]["Name"]["Color"][2]);
                    current_y = doc.Boxed_Text(Name, Data["Style"]["Name"]["X"], Data["Style"]["Name"]["Y"] ,Data["Style"]["Name"]["Width"]);
                }

                if(Data["Style"]["JobTitle"] != undefined){
                    Name = Info["JobTitle"]
                    doc.setFont(Data["Style"]["JobTitle"]["Font"][0],Data["Style"]["JobTitle"]["Font"][1])
                    doc.setFontSize(Data["Style"]["JobTitle"]["FontSize"]);
                    doc.setTextColor(Data["Style"]["JobTitle"]["Color"][0],Data["Style"]["JobTitle"]["Color"][1],Data["Style"]["JobTitle"]["Color"][2]);
                    current_y = doc.Boxed_Text(Name, Data["Style"]["JobTitle"]["X"], current_y + Data["Style"]["JobTitle"]["Y"] ,Data["Style"]["JobTitle"]["Width"]);
                }

                // Contact Side Bar
                if(Data["Style"]["SideBarHeader"] != undefined){
                    doc.setFillColor(Data["Style"]["SideBarHeader"]["Color"][0],Data["Style"]["SideBarHeader"]["Color"][1],Data["Style"]["SideBarHeader"]["Color"][2]);
                    doc.rect(Data["Style"]["SideBarHeader"]["X"],current_y,Data["Style"]["SideBarHeader"]["Width"],Data["Style"]["SideBarHeader"]["Height"],'F')
                }

                Draw(doc,"Contact",Data["Style"]["Contact"],current_y)
                current_y += 12
                if(Data["Style"]["Contact"] != undefined)
                {
                    doc.setFontSize(14);

                    Object.keys(Info["Contacts"]).forEach(element => {
                        doc.setFont("Helvetica","Bold")
                        doc.text(2,current_y+5,element+":")
                        doc.setFont("Helvetica","")
                        y = 0
                        doc.splitTextToSize(Info["Contacts"][element], 60).forEach(element2 => {
                            doc.text(2,current_y+10+y,element2)
                            y += 5
                        });
                        if(Info["Contacts"][element].includes("http"))
                        {
                            //doc.rect(2,current_y+5,60,20,'F')
                           // doc.link(2,current_y+10,65,20,{ url: Info["Contacts"][element] })
                        }
                        current_y += 10+y
                    });
                }

                // Skills
                if(Data["Style"]["SideBarHeader"] != undefined){
                    doc.setFillColor(Data["Style"]["SideBarHeader"]["Color"][0],Data["Style"]["SideBarHeader"]["Color"][1],Data["Style"]["SideBarHeader"]["Color"][2]);
                    doc.rect(Data["Style"]["SideBarHeader"]["X"],current_y,Data["Style"]["SideBarHeader"]["Width"],Data["Style"]["SideBarHeader"]["Height"],'F')
                }

                Draw(doc,"Skills",Data["Style"]["Contact"],current_y)
                
            }

           // ProgressBar(doc,0,0,100,10,[10,10,10],[255,255,255],50)
            

            // To Be Complated
            doc.setFontSize(Data["Style"]["JobTitle"]["FontSize"]);
            
            doc.rect(70,2,132,.5,'F')
            doc.text(72,9,"Summary")
            doc.rect(70,12,132,.5,'F')

            doc.setFontSize(12)
            var lines = doc.splitTextToSize($("#Summary").val(), 132);
            doc.text(70,20,lines)


            doc.setFontSize(Data["Style"]["JobTitle"]["FontSize"]);
            doc.rect(70,45,132,.5,'F')
            doc.text(72,52,"Work History")
            doc.rect(70,55,132,.5,'F')

           // doc.textWithLink('Click here\nHello World', 0, 50, { url: 'https://gamemill.github.io/Website-For-Codenation/' });

            
            $("#frame").attr('src', doc.output('datauristring'))

        }

        function Draw(doc,text,data,current_y)
        {
            doc.setFont(data["Font"][0],Data["Style"]["Contact"]["Font"][1])
            doc.setFontSize(data["FontSize"]);
            doc.setTextColor(data["Color"][0],data["Color"][1],Data["Style"]["Contact"]["Color"][2]);
            doc.text(text, data["X"], current_y+data["Y"]);
            return current_y+data["Y"]
        }
        function download(filename, text) {
            var element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }
    </script>
    <style>
        #frame{
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>

    <div>
        <div class="row">

          <div class="col">
            <input type="file" id="SaveFile"/>

            <select id="Templates" onchange="UpdateTemplate()">
                <option value="Template1">
                    Blue lake 
                </option>
            </select>

            <div id="TemplateName"></div>
            <hr/>
            <h6>Personal Details</h6>
            <div class="form-group row">
                <label for="Name" class="col-sm-2 col-form-label" style="text-align: right;">Full Name:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="Name">
                </div>
            </div>

            <div class="form-group row">
                <label for="JobTitle" class="col-sm-2 col-form-label" style="text-align: right;">Job Title:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="JobTitle">
                </div>
            </div>

            <hr/>
            <h6>Contact Details</h6>
            <div class="form-group row">
                <label for="ContactName" class="col-sm-2 col-form-label" style="text-align: right;">Name:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" id="ContactName">
                </div>
                <label for="ContactValue" class="col-sm-2 col-form-label" style="text-align: right;">Value:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" id="ContactValue">
                </div>
                <button class="col-sm-2 btn btn-primary" onclick="newContact()">Add</button>
            </div>

            <table id="ContactsList" class="table">
                <thead>
                  <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Value</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>

                </tbody>
              </table>

            <button type="button" onclick="MakePage()">Render</button>
            <hr>
            <h6>Summary</h6>
            <textarea style="width: 100%; height: 100px;" id="Summary"></textarea>
          </div>

          <div class="col">
            <iframe id="frame"></iframe>
          </div>

        </div>
      </div>
    



<button onclick="GetDataObject()">GetObject</button>
    <script src="./css/fonts/Hash44-bold.js"></script>

    <script src="/TemplateController.js"></script>
</body>
</html>